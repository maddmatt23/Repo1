<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>On-Page Search (Enter to find, jump to hit)</title>
<style>
  :root{
    --bg:#0b1220; --panel:#141b2d; --ink:#e9eef7; --muted:#a9b3c7;
    --accent:#4bb3ff; --accent-2:#6ee7b7; --warn:#f59e0b;
  }
  html,body{height:100%}
  body{margin:0;font:16px/1.45 system-ui, -apple-system, Segoe UI, Roboto, Arial;
       color:var(--ink);background:linear-gradient(180deg,#0e1629,#0b1220)}
  /* Demo content area */
  .content{max-width:900px;margin:110px auto 80px;padding:0 20px}
  .content h1,.content h2{margin:1.2em 0 .4em}
  .content p{color:#cfd7e6}
  /* Search UI */
  .searchbar{
    position:fixed; inset:16px 16px auto 16px; z-index:99999;
    display:flex; gap:8px; align-items:center; padding:10px 12px;
    background:linear-gradient(180deg,var(--panel),#0f172a 60%);
    border:1px solid #1f2a44; box-shadow:0 10px 25px rgba(0,0,0,.35);
    border-radius:14px;
  }
  .searchbar *{font:inherit}
  .searchbar [data-role="status"]{color:var(--muted); min-width:90px; text-align:center}
  .searchbar input[type="search"]{
    flex:1; min-width:260px; padding:10px 12px 10px 36px; color:var(--ink);
    background:rgba(255,255,255,.04); border:1px solid #26324f; border-radius:10px;
    outline:none;
  }
  .searchbar input[type="search"]::placeholder{color:#98a5bf}
  .searchbar .btn{
    user-select:none; border:1px solid #26324f; background:#10182a; color:var(--ink);
    padding:9px 12px; border-radius:10px; cursor:pointer;
  }
  .searchbar .btn[disabled]{opacity:.45; cursor:not-allowed}
  .searchbar .icon{
    position:absolute; margin-left:12px; pointer-events:none; opacity:.7
  }
  .searchbar .tiny{font-size:12px; color:var(--muted); padding:0 4px}
  /* Highlight styling */
  mark.sb-hit{
    background:linear-gradient(90deg, rgba(75,179,255,.35), rgba(110,231,183,.35));
    padding:2px 0; border-radius:2px;
    box-shadow:0 0 0 1px rgba(75,179,255,.25) inset;
    scroll-margin-top:90px; /* keeps hit clear of the fixed bar */
  }
  /* Focus ring for the active hit */
  .sb-active{
    outline:3px solid var(--accent);
    transition:outline-color .2s ease;
  }
  /* Small keyboard help */
  .help{
    position:fixed; right:18px; bottom:18px; color:#9fb0cc; font-size:13px;
    background:rgba(16,24,42,.7); border:1px solid #26324f; padding:8px 10px; border-radius:10px;
  }
  /* Prevent the search UI from being included in results */
  .searchbar,[data-no-search]{contain:content}
</style>
</head>
<body>

<!-- Search UI -->
<div class="searchbar" role="search" aria-label="On-page search" data-no-search>
  <svg class="icon" width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M21 21l-4.3-4.3m1.3-5.2a6.5 6.5 0 11-13 0 6.5 6.5 0 0113 0z"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <input id="sb-input" type="search" placeholder="Search this page, then press Enter"
         autocomplete="off" spellcheck="false" aria-controls="sb-status" />
  <button id="sb-prev" class="btn" title="Previous match" disabled>Prev</button>
  <button id="sb-next" class="btn" title="Next match" disabled>Next</button>
  <span id="sb-status" class="tiny" data-role="status" aria-live="polite">0 results</span>
  <button id="sb-clear" class="btn" title="Clear results" disabled>Clear</button>
</div>

<!-- Demo content. Replace with your page content. -->
<div class="content" id="page-content">
  <h1>Sample Page Content</h1>
  <p>This is placeholder text so you can test the on-page search. Enter a word like “vacuum”, “caliper”, or “safety”.</p>
  <p>In a typical engineering workspace you might reference a vacuum chamber, a megger tester for insulation resistance, a digital caliper for quick checks, and a torque wrench for fasteners.</p>
  <h2>Good housekeeping</h2>
  <p>Keep aisles clear, label drawers, and store measuring tools where they are used. Reduce motion and waiting by keeping common items near the point of use.</p>
  <h2>Safety reminders</h2>
  <p>Verify isolation before tests, follow lockout procedures, and document the results. If something looks off, stop and investigate.</p>
  <p>Try a search for “tester”, then use Next and Prev to move between hits.</p>
</div>

<div class="help" data-no-search>
  Enter to search. Enter again to jump to next. Esc to clear.
</div>

<script>
(function(){
  const input = document.getElementById('sb-input');
  const btnNext = document.getElementById('sb-next');
  const btnPrev = document.getElementById('sb-prev');
  const btnClear = document.getElementById('sb-clear');
  const status = document.getElementById('sb-status');
  const NO_SEARCH_SELECTOR = '[data-no-search]';
  const SKIP_TAGS = new Set(['SCRIPT','STYLE','NOSCRIPT','IFRAME','CANVAS','SVG','VIDEO','AUDIO','CODE','KBD','SAMP','PRE','BUTTON','INPUT','TEXTAREA','SELECT']);
  let hits = [];           // Array<HTMLElement> for each wrapped match
  let activeIndex = -1;    // Current match index
  let lastQuery = '';      // Query used for the current highlight set

  function isElementVisible(el){
    if(!el || el.nodeType !== 1) return false;
    const cs = window.getComputedStyle(el);
    if(cs.display === 'none' || cs.visibility === 'hidden' || cs.opacity === '0') return false;
    // Walk up to ensure no ancestor hides it or is marked no-search
    let cur = el;
    while(cur && cur !== document.body){
      if(cur.matches && cur.matches(NO_SEARCH_SELECTOR)) return false;
      const s = window.getComputedStyle(cur);
      if(s.display === 'none' || s.visibility === 'hidden' || s.opacity === '0') return false;
      cur = cur.parentElement;
    }
    return true;
  }

  function escapeRegExp(str){
    return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
  }

  function clearHighlights(){
    // Remove active outline
    hits.forEach(h => h.classList.remove('sb-active'));
    // Unwrap all hits back to plain text
    const nodes = document.querySelectorAll('mark.sb-hit');
    nodes.forEach(mark => {
      const text = document.createTextNode(mark.textContent);
      mark.replaceWith(text);
    });
    hits = [];
    activeIndex = -1;
    setStatus(0, 0);
    setControlsEnabled(false);
  }

  function setStatus(i, total){
    if(total === 0){ status.textContent = '0 results'; return; }
    status.textContent = `${i+1} of ${total}`;
  }

  function setControlsEnabled(hasResults){
    btnNext.disabled = !hasResults;
    btnPrev.disabled = !hasResults;
    btnClear.disabled = !hasResults;
  }

  function highlightMatches(query){
    if(!query) return 0;
    const qLower = query.toLowerCase();
    const walker = document
